<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#4A90E2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Chidiya Udd">
  <meta name="description" content="Classic Indian touch-based reaction game - Keep your finger down or lift it based on whether the object can fly!">
  <meta name="keywords" content="chidiya udd, bird fly, indian game, reaction game, multiplayer, touch game">
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%234A90E2' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle'>ğŸ¦</text></svg>">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles-v2.css">
  
  <title>Chidiya Udd - Bird Fly Game</title>
</head>
<body>
  
  <!-- ==========================================
       HOME SCREEN
       ========================================== -->
  <section id="home-screen" class="screen home-screen active">
    <div class="screen-content">
      <div class="logo-container">
        <div class="logo-bird">ğŸ¦</div>
      </div>
      
      <h1 class="app-title title">Chidiya Udd</h1>
      <p class="app-tagline">The Classic Bird Fly Game</p>
      
      <div class="menu-buttons">
        <button id="btn-play-offline" class="btn btn-primary btn-lg">
          <span>ğŸ®</span>
          <span>Play Offline</span>
        </button>
        <button id="btn-play-online" class="btn btn-secondary btn-lg">
          <span>ğŸŒ</span>
          <span>Play Online</span>
        </button>
      </div>
      
      <div class="menu-bottom">
        <button id="btn-how-to-play" class="btn btn-outline">
          <span>â“</span>
          <span>How to Play</span>
        </button>
        <button id="btn-settings" class="btn btn-icon">
          âš™ï¸
        </button>
      </div>
    </div>
  </section>
  
  <!-- ==========================================
       PLAYER SELECTION SCREEN
       ========================================== -->
  <section id="player-select-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Select Players</h2>
      <p class="subtitle">Choose how many players (same device)</p>
      
      <div id="player-grid" class="player-grid">
        <!-- Player count buttons will be generated by JS -->
      </div>
      
      <button id="btn-back-home" class="btn btn-outline">
        â† Back
      </button>
    </div>
  </section>
  
  <!-- ==========================================
       GAME SETUP SCREEN
       ========================================== -->
  <section id="game-setup-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Get Ready!</h2>
      <p class="subtitle">Place your finger on your circle</p>
      
      <div class="game-area">
        <div id="setup-circles-container" class="circles-container">
          <!-- Player circles will be generated by JS -->
        </div>
      </div>
      
      <div style="display: flex; gap: 16px; margin-top: 24px;">
        <button id="btn-back-select" class="btn btn-outline btn-sm">
          â† Back
        </button>
        <button id="btn-ready" class="btn btn-primary btn-lg btn-disabled">
          Ready to Start!
        </button>
      </div>
    </div>
  </section>
  
  <!-- ==========================================
       GAME SCREEN
       ========================================== -->
  <section id="game-screen" class="screen">
    <header class="game-header">
      <button id="btn-back-game" class="btn btn-icon">â†</button>
      <span id="round-indicator" class="round-indicator">Round 1/15</span>
      <button id="btn-pause" class="btn btn-icon">â¸ï¸</button>
    </header>
    
    <div class="game-area">
      <div class="game-center">
        <div id="timer-ring" class="timer-ring">
          <svg viewBox="0 0 200 200">
            <circle class="timer-bg" cx="100" cy="100" r="90"></circle>
            <circle id="timer-progress" class="timer-progress" cx="100" cy="100" r="90"></circle>
          </svg>
          <div id="object-display" class="object-display-container">
            <div id="object-emoji" class="object-emoji">ğŸ¦</div>
            <div id="object-name" class="object-display">PARROT</div>
          </div>
        </div>
      </div>
      
      <div id="game-circles-container" class="circles-container">
        <!-- Player circles will be generated by JS -->
      </div>
    </div>
  </section>
  
  <!-- ==========================================
       RESULTS SCREEN
       ========================================== -->
  <section id="results-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">ğŸ‰ Game Over!</h2>
      
      <div class="results-container">
        <div id="leaderboard" class="leaderboard">
          <!-- Leaderboard items will be generated by JS -->
        </div>
      </div>
      
      <div style="display: flex; gap: 16px; margin-top: 32px; flex-wrap: wrap; justify-content: center;">
        <button id="btn-play-again" class="btn btn-primary">
          ğŸ”„ Play Again
        </button>
        <button id="btn-main-menu" class="btn btn-outline">
          ğŸ  Main Menu
        </button>
      </div>
    </div>
    
    <div id="confetti-container" class="confetti-container"></div>
  </section>
  
  <!-- ==========================================
       ONLINE MENU SCREEN
       ========================================== -->
  <section id="online-menu-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Online Mode</h2>
      <p class="subtitle">Play with friends on different devices</p>
      
      <div class="menu-buttons">
        <button id="btn-create-room" class="btn btn-primary btn-lg">
          <span>ğŸ </span>
          <span>Create Room</span>
        </button>
        <button id="btn-join-room" class="btn btn-secondary btn-lg">
          <span>ğŸšª</span>
          <span>Join Room</span>
        </button>
      </div>
      
      <button id="btn-back-home-online" class="btn btn-outline" style="margin-top: 32px;">
        â† Back
      </button>
    </div>
  </section>
  
  <!-- ==========================================
       CREATE ROOM SCREEN
       ========================================== -->
  <section id="create-room-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Your Room</h2>
      
      <div class="room-code-display">
        <span class="room-code-label">Room Code</span>
        <span id="display-room-code" class="room-code">------</span>
        <button id="btn-copy-code" class="btn btn-sm btn-outline">
          ğŸ“‹ Copy
        </button>
      </div>
      
      <p id="online-message" class="waiting-message">Creating room...</p>
      <p id="online-error" class="error-message" style="display: none;"></p>
      
      <div id="lobby-players" class="players-list">
        <!-- Players will be listed here -->
      </div>
      
      <div style="display: flex; gap: 16px; margin-top: 24px;">
        <button id="btn-cancel-room" class="btn btn-outline">
          Cancel
        </button>
        <button id="btn-start-game" class="btn btn-primary btn-disabled">
          Start Game
        </button>
      </div>
    </div>
  </section>
  
  <!-- ==========================================
       JOIN ROOM SCREEN
       ========================================== -->
  <section id="join-room-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Join Room</h2>
      <p class="subtitle">Enter the room code</p>
      
      <input 
        type="text" 
        id="room-code-input" 
        class="room-code-input" 
        placeholder="ABCDEF"
        maxlength="6"
        autocomplete="off"
        autocapitalize="characters"
      >
      
      <p id="join-error" class="error-message" style="display: none;"></p>
      
      <div style="display: flex; gap: 16px; margin-top: 24px;">
        <button id="btn-back-online-menu" class="btn btn-outline">
          â† Back
        </button>
        <button id="btn-join-submit" class="btn btn-primary">
          Join
        </button>
      </div>
    </div>
  </section>
  
  <!-- ==========================================
       LOBBY SCREEN (for joined players)
       ========================================== -->
  <section id="lobby-screen" class="screen">
    <div class="screen-content">
      <h2 class="title">Waiting Room</h2>
      
      <div id="lobby-players" class="players-list">
        <!-- Players will be listed here -->
      </div>
      
      <p class="waiting-message">Waiting for host to start the game...</p>
      
      <button id="btn-leave-room" class="btn btn-outline" style="margin-top: 24px;">
        Leave Room
      </button>
    </div>
  </section>
  
  <!-- ==========================================
       COUNTDOWN OVERLAY
       ========================================== -->
  <div id="countdown-overlay" class="countdown-overlay">
    <span id="countdown-number" class="countdown-number">3</span>
  </div>
  
  <!-- ==========================================
       SETTINGS MODAL
       ========================================== -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">âš™ï¸ Settings</h3>
        <button class="modal-close">âœ•</button>
      </div>
      
      <div class="settings-group">
        <div class="settings-item">
          <span class="settings-label">
            <span class="settings-icon">ğŸ”Š</span>
            <span>Sound Effects</span>
          </span>
          <div id="toggle-sound" class="toggle active"></div>
        </div>
        
        <div class="settings-item">
          <span class="settings-label">
            <span class="settings-icon">ğŸ“³</span>
            <span>Vibration</span>
          </span>
          <div id="toggle-vibration" class="toggle active"></div>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 24px;">
        <p style="font-size: 0.75rem; color: #9E9E9E;">
          Chidiya Udd v1.0.0<br>
          Made with â¤ï¸
        </p>
      </div>
    </div>
  </div>
  
  <!-- ==========================================
       HOW TO PLAY MODAL
       ========================================== -->
  <div id="how-to-play-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">â“ How to Play</h3>
        <button class="modal-close">âœ•</button>
      </div>
      
      <div class="tutorial-content">
        <div class="tutorial-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>Place Your Finger</h4>
            <p>Each player places and holds their finger on their colored circle.</p>
          </div>
        </div>
        
        <div class="tutorial-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>Watch the Object</h4>
            <p>An object or animal name will appear in the center of the screen.</p>
          </div>
        </div>
        
        <div class="tutorial-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>React Quickly!</h4>
            <p>If the object <strong>CAN FLY</strong>, lift your finger UP. If it <strong>CANNOT FLY</strong>, keep your finger DOWN.</p>
            
            <div class="example-box">
              <div class="example">
                <div class="example-emoji">ğŸ¦…</div>
                <div class="example-label">EAGLE</div>
                <div class="example-action lift">â˜ï¸ LIFT UP</div>
              </div>
              <div class="example">
                <div class="example-emoji">ğŸ„</div>
                <div class="example-label">COW</div>
                <div class="example-action keep">ğŸ‘‡ KEEP DOWN</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tutorial-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h4>Score Points</h4>
            <p>Correct action: <strong style="color: #4CAF50">+10 points</strong><br>
            Wrong action: <strong style="color: #F44336">-5 points</strong></p>
          </div>
        </div>
        
        <div class="tutorial-step">
          <div class="step-number">5</div>
          <div class="step-content">
            <h4>Watch Out!</h4>
            <p>Some birds can't fly! ğŸ§ Penguins, ğŸ¦¤ Ostriches, and ğŸ¥ Kiwis are trick items - keep your finger DOWN!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ==========================================
       SCRIPTS
       ========================================== -->
  
  <!-- PeerJS for multiplayer (loaded from CDN) -->
  <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
  
  <!-- Game Logic -->
  <script src="game-v2.js"></script>
  
  <!-- Multiplayer Logic -->
  <script src="peer-multiplayer.js"></script>
  
  <!-- Service Worker UN-Registration -->
  <script>
    // UNregister service worker to fix caching issues
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for(let registration of registrations) {
            console.log('Unregistering SW:', registration);
            registration.unregister();
          }
        });
      });
    }
    
    // Handle URL parameters (for PWA shortcuts)
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    if (mode === 'offline') {
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('btn-play-offline')?.click();
      });
    } else if (mode === 'online') {
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('btn-play-online')?.click();
      });
    }
    
    // Prevent zoom on double-tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });
    
    // Prevent pinch zoom
    document.addEventListener('gesturestart', (e) => {
      e.preventDefault();
    });
  </script>
</body>
</html>
